# Dynamic templates

Динамическая замена шаблонизатора [quicktemplate](https://github.com/valyala/quicktemplate).

## Ретроспетива

Мы долгое время использовали quicktemplate для создания JSON докементов для обмена данными между микросервисами в
высоконагруженном проекте и qtpl обеспечивал очень хорошую скорость работы. Далее появилась необходимость менять
шаблоны (или создавать новые) на лету. К сожалению, qtpl не поддерживает такую возможность и эта библиотека была
разработана как замена со сравнимой скоростью и динамическими возможностями. Соотвественно она во многом она следует
синтаксису qtpl.

## Принцип работы

В процессе разработки наибольшей проблемой стало получение данных из произвольных структур без использования рефлексии,
поскольку пакет `reflect` слишком медленный и делает много аллоков при любом использовании типа `reflect.Value`.

Для решения этой проблемы был разработан фреймворк [inspector](https://github.com/koykov/inspector/blob/master/readme.ru.md).
Он предоставляет примитивные методы для чтения данных из структур, итерирования и тд. без использования рефлексии, причём
делает это быстро. Это достигается посредством использования кодогенерации - inspector для каждой указанной структуры
(или пакета целиком) делает специальные типы, содержащие код специфичный для конкретной структуры. Это не чистая динамика
какую предоставляет пакет `reflect`, но за то работает на порядки быстрее и не делает аллокаций.

Пример работы инспетора можно посмотреть в пакете [testobj_ins](./testobj_ins), ктоорый был сгенерирован на основе
пакета [testobj](./testobj).
